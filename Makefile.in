PYTHON = @PYTHON@
VIRTUALENV = @VIRTUALENV@

all :
	$(PYTHON) setup.py build

install : all
	$(PYTHON) setup.py install --force

sdist : all
	$(PYTHON) setup.py sdist

clean :
	rm -rf dist
	rm -rf build
	rm -rf *.egg-info
	rm -rf autom4te.cache
	$(RM) unit-tests/*/test_*.py.log
	$(RM) load-tests/test_*.py.log
	$(RM) config.log config.status

distclean : clean
	$(RM) Makefile
	rm -rf test-env

realclean : distclean
	rm -rf package

install-testing : test-env all
	test-env/bin/python setup.py install --force

.PHONY: unit-tests
.PHONY: unit-tests/api
.PHONY: unit-tests/core
.PHONY: unit-tests/hooks

unit-tests/api : test-env install-testing
	@for test in unit-tests/api/*.py; \
	    do test-env/bin/python $$test -v; done

unit-tests/core : test-env install-testing
	@for test in unit-tests/core/*.py; \
	    do test-env/bin/python $$test -v; done

unit-tests/hooks : test-env install-testing
	@for test in unit-tests/hooks/*.py; \
	    do test-env/bin/python $$test -v; done

unit-tests : unit-tests/api unit-tests/core

.PHONY: load-tests

load-tests : test-env install-testing
	@echo Usage: test-env/bin/python load-tests/test_load_test_??.py

test-env :
	$(VIRTUALENV) test-env
