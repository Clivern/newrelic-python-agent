[tox]
envlist =
    py27-cherrypy31-with-extensions,

    py26-cherrypy32-without-extensions,
    py27-cherrypy32-without-extensions,
    py33-cherrypy32-without-extensions,
    pypy-cherrypy32-without-extensions,

    py26-cherrypy32-with-extensions,
    py27-cherrypy32-with-extensions,
    py33-cherrypy32-with-extensions,

[testenv]
deps =
    pytest
    pytest-cov
    routes
    WebTest
    ../../dist/newrelic-2.1.0.0.tar.gz
commands =
    /bin/rm -f newrelic.log
    newrelic-admin run-program \
            py.test -v --cov newrelic_hooks --cov-report html []
setenv =
    NEW_RELIC_CONFIG_FILE = newrelic.ini
    NEW_RELIC_LOG = newrelic.log
    NEW_RELIC_LOG_LEVEL = debug
    NEW_RELIC_STARTUP_TIMEOUT = 10.0
    NEW_RELIC_SHUTDOWN_TIMEOUT = 10.0

[testenv:py27-cherrypy31-with-extensions]
basepython = python2.7
deps =
    {[testenv]deps}
    CherryPy==3.1.2
setenv =
    {[testenv]setenv}
    NEW_RELIC_EXTENSIONS = true

[testenv:py26-cherrypy32-without-extensions]
basepython = python2.6
deps =
    {[testenv]deps}
    CherryPy==3.2.4
setenv =
    {[testenv]setenv}
    NEW_RELIC_EXTENSIONS = false

[testenv:py27-cherrypy32-without-extensions]
basepython = python2.7
deps =
    {[testenv]deps}
    CherryPy==3.2.4
setenv =
    {[testenv]setenv}
    NEW_RELIC_EXTENSIONS = false

[testenv:py33-cherrypy32-without-extensions]
basepython = python3.3
deps =
    {[testenv]deps}
    CherryPy==3.2.4
setenv =
    {[testenv]setenv}
    NEW_RELIC_EXTENSIONS = false

[testenv:pypy-cherrypy32-without-extensions]
basepython = pypy
deps =
    {[testenv]deps}
    CherryPy==3.2.4
setenv =
    {[testenv]setenv}
    NEW_RELIC_EXTENSIONS = false

[testenv:py26-cherrypy32-with-extensions]
basepython = python2.6
deps =
    {[testenv]deps}
    CherryPy==3.2.4
setenv =
    {[testenv]setenv}
    NEW_RELIC_EXTENSIONS = true

[testenv:py27-cherrypy32-with-extensions]
basepython = python2.7
deps =
    {[testenv]deps}
    CherryPy==3.2.4
setenv =
    {[testenv]setenv}
    NEW_RELIC_EXTENSIONS = true

[testenv:py33-cherrypy32-with-extensions]
basepython = python3.3
deps =
    {[testenv]deps}
    CherryPy==3.2.4
setenv =
    {[testenv]setenv}
    NEW_RELIC_EXTENSIONS = true
