# Distributed Tracing Cross Agent Tests

The `distributed_tracing.json` file included here is our local copy of the
Better Better CAT CAT [tests](https://source.datanerd.us/agents/cross_agent_tests/pull/96/files).

The tests in json format and is a list of dictionaries, each dictionary
representing one test.

## Required fields

Each test will include these fields:

+ `test_name`: A string representing the test name.
+ `comment`: String; optional field. Describes the test.
+ `inbound_payloads`: List representing distributed trace payloads as described
  in the spec. AcceptDistributedTracePayload should be called with each payload
  in turn.
+ `account_id` String. The account_id to use for this test.
+ `transport_type` String. If the transport_type is 'HTTP', payloads will be
  generated via a request to a dummy WSGI server. Otherwise, they'll be
  generated manually.
+ `major_version`: Integer. The expected major version of the payload.
+ `minor_version`: Integer. The expected minor version of the payload.
+ `trusted_account_key`: String. The earliest ancestor trusted account id.
+ `force_sampled_true`: Boolean. Currently does nothing.
+ `expected_metrics`: List. Each list item itself is also a list of length two.
  The first item in the list is a metric name (unscoped). The second item is
  the expected number of occurrences of that metric. When a `null` is
  encountered, then the metric is expected to be absent.
+ `web_transaction`: Boolean. Whether the test should be run
  as a web transaction (as opposed to a background task).
+ `raises_exception`: Boolean, defaults to false. Whether the test should raise
  and record an exception (thus creating error traces, error events, etc).
+ `span_events_enabled`: Boolean. Whether span events are expected to be
  enabled for this test. (that is to say, whether span events are generated and
  validated or not)
+ `outbound_payloads`: List. For each item in the list, an outgoing request
  should be made during the distributed trace transaction. The list item itself
  is a dict, with the key, value pairs that should be asserted. Note that
  keys prepended with "d." are in the `data` portion of the outgoing payload.
+ `intrinsics`: Dictionary. Has a specific format, as described below.

## "Intrinsics" field attributes

+ `target_events`: List of strings. Each string represents an event type that
  will be generated by this test. Each string will also appear as a field in
  this `intrinsics` dict, with the same format as `common`.

+ `common`: A dict representing common attributes for all generated event
  types. The key/value pairs in `common` should be unioned with the values for
  each specific event type. Both `common` and the specific events will each
  have three subfields: `expected`, `unexpected`, and `exact`. The first two
  list of fields that should and should not, respectably, be present in the
  are event's attributes. `exact`, on the other hand, is a dict with key/value
  pairs describing what each attribute's exact value should be.
